<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout/layout :: head">

<body>

<header th:replace="layout/layout :: header"></header>

    <div class="container-fluid py-4">

        <div class="card bg-dark text-white">
            <div class="card-header" th:text="${titulo} + ${' - Total Registros: ' + contratos.size()}"></div>
            <div class="card-body color-metal">
                <a class="btn btn-secondary btn-sm mb-4" th:href="@{/registro/export-excel}">Exportar&nbsp;&nbsp;
                    <span class="far fa-file-excel"></span>
                </a>
                <form th:action="@{/registro/buscar/}" method="post">
                    <div class="form-row">
                        <div class="col-sm-3">
                            <div class="form-group row">
                                <label for="run" class="col-form-label col-sm-2 font-weight-bolder">Run: </label>
                                <div class="col-sm-4">
                                    <input type="text" id="run" name="run" class="form-control form-control-sm">
                                </div>
                                <div class="col-sm-4">
                                    <button class="btn btn-secondary btn-sm" type="submit" name="buscar" id="buscar" value="btnBuscar">Buscar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <form th:action="@{/registro/acciones/}" method="post">
                    <div class="table-responsive-xxl" style="height: 500px !important; overflow: scroll;"> <!-- width: auto; -->
                        <table class="table table-striped table-bordered table-hover table-dark table-sm mt-3">
                            <thead>
                                <tr style="font-size:10px;">
                                    <th>
                                        <input type="checkbox" name="checkedAll" id="checkedAll">
                                    </th>
                                    <th>Editar</th>
                                    <th>N°</th>
                               <!-- <th>Id</th> -->
                                    <th>Servicio de Salud</th>
                                    <th>Comuna</th>
                                    <th>Establecimiento</th>
                                    <th>Administración</th>
                                    <th>Run</th>
                                    <th>Nombre</th>
                                    <th>Sexo</th>
                                    <th>Fecha Nacimiento</th>
                                    <th>Nacionalidad</th>
                                    <th>Ley Contratación</th>
                                    <th>Tipo de contrato</th>
                                    <th>Categoría</th>
                                    <th>Nivel Carrera</th>
                                    <th>Profesión</th>
                                    <th>Especialidad</th>
                                    <th>Cargo</th>
                                    <th>Asig. Chofer</th>
                                    <th>Jornada</th>
                                    <th>Años de Serv.</th>
                                    <th>Fecha Ingreso</th>
                                    <th>Bienios</th>
                                    <th>Previsión</th>
                                    <th>Isapre</th>
                                    <th>Sueldo Base</th>
                                    <th>Total Haberes</th>
                                    <th>Validado</th>
                                    <th>Revisado</th>
                                    <th>Habilitado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="contrato, iterator: ${contratos}" style="font-size:10px;">
                                    <td align="center">
                                        <input type="checkbox" name="checkAllTextArray" class="checkSingle" th:value="${contrato.id}">
                                    </td>
                                    <td style="font-size:12px;">
                                        <a class="badge badge-secondary" th:href="@{/contrato/form-editar/} + ${contrato.id}" th:text="'Editar'"></a>
                                    </td>
                                    <td th:text="${iterator.index+1}"></td>
                               <!-- <td th:text="${contrato.id}"></td> -->
                                    <td th:text="${contrato.servicioSalud.servicioSalud}"></td>
                                    <td th:text="${contrato.comuna.comuna}"></td>
                                    <td th:text="${contrato.establecimiento.establecimientoNombre}"></td>
                                    <td th:text="${contrato.adminSalud.adminSalud}"></td>
                                    <td th:text="${contrato.funcionario.run}"></td>
                                    <td th:text="${contrato.funcionario.nombres} + ' ' + ${contrato.funcionario.apellidoPaterno} + ' ' + ${contrato.funcionario.apellidoMaterno}" ></td>
                                    <td th:text="${contrato.funcionario.sexo.sexo}"></td>
                                    <td th:text="${#dates.format(contrato.funcionario.fechaNacimiento, 'dd/MM/yyyy')}"></td>
                                    <td th:text="${contrato.funcionario.nacionalidad.nacionalidad}"></td>
                                    <td th:text="${contrato.ley.ley}"></td>
                                    <td th:text="${contrato.tipoContrato.tipoContrato}"></td>
                                    <td th:text="${contrato.categoriaProfesion.categoriaProfesion}"></td>
                                    <td th:text="${contrato.nivelCarrera.nivelCarrera} == 0 ? 'N/A' : ${contrato.nivelCarrera.nivelCarrera}"></td>
                                    <td th:text="${contrato.profesion.profesion}"></td>
                                    <td th:text="${contrato.especialidad.especialidad}"></td>
                                    <td th:text="${contrato.cargo.cargo}"></td>
                                    <td th:text="${contrato.asignacionChofer.asignacionChofer}"></td>
                                    <td th:text="${contrato.jornadaLaboral}"></td>
                                    <td th:text="${contrato.aniosServicio}"></td>
                                    <td th:text="${#dates.format(contrato.fechaIngreso, 'dd/MM/yyyy')}"></td>
                                    <td th:text="${contrato.bienios.bienios}"></td>
                                    <td th:text="${contrato.prevision.prevision}"></td>
                                    <td th:text="${contrato.isapre.isapre}"></td>
                                    <td th:text="${#numbers.formatInteger(contrato.sueldoBase,3,'POINT')}"></td>
                                    <td th:text="${#numbers.formatInteger(contrato.totalHaberes,3,'POINT')}"></td>
                                    <td th:text="${contrato.validado} ? 'Si' : 'No'"></td>
                                    <td th:text="${contrato.revisado} ? 'Si' : 'No'"></td>
                                    <td th:text="${contrato.enabled} ? 'Si' : 'No'"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- ########################################### Button Form ################################################ -->
                    <div class="form-group row justify-content-center text-center mt-4">
                        <div class="col-sm-4" sec:authorize="hasRole('ROLE_COMUNA')">
                            <input id="btnRevisarRegistros" name="btnRevisarRegistros" type="submit" value="Revisar Registros" class="btn btn-secondary" onclick="return confirm('Estás seguro que quieres revisar?')">
                        </div>
                        <div class="col-sm-4" sec:authorize="hasAnyRole('ROLE_MINSAL', 'ROLE_COMUNA')">
                            <input id="btnEliminarRegistros" name="btnEliminarRegistros" type="submit" value="Eliminar Registros" class="btn btn-dark" onclick="return confirm('Estás seguro que quieres eliminar?')">
                        </div>
                        <div class="col-sm-4" sec:authorize="hasAnyRole('ROLE_MINSAL', 'ROLE_SERVICIO', 'ROLE_LA_GRANJA')">
                            <input id="btnValidarRegistros" name="btnValidarRegistros" type="submit" value="Validar Registros" class="btn btn-dark" onclick="return confirm('Estás seguro que quieres validar?')">
                        </div>
                    </div>
                </form>
            </div>
        </div>

    </div>

<footer th:replace="layout/layout :: footer"></footer>

</body>
</html>